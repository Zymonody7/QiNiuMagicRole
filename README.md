# 奇牛幻角（Qiniu MagicRole）

## 项目概述

奇牛幻角是一个基于AI技术的智能角色扮演平台，用户可以与历史人物、文学角色、科学家等AI角色进行语音对话。项目采用现代化的技术栈，支持实时语音交互、智能对话生成、角色技能系统等核心功能。

## 目标用户群体

### 主要用户类型
- **教育工作者**：历史老师、文学老师、语言老师
- **学生群体**：历史爱好者、文学爱好者、语言学习者  
- **娱乐用户**：角色扮演爱好者、AI聊天爱好者
- **内容创作者**：需要角色配音的创作者

### 用户痛点
- 传统学习方式枯燥，缺乏互动性
- 历史人物、文学角色难以直观了解
- 语言学习缺乏真实对话场景
- 角色扮演游戏缺乏智能AI支持

### 用户故事
- 历史老师张老师想要让学生与苏格拉底对话，了解古希腊哲学思想
- 学生小李想与哈利·波特讨论魔法世界，提高英语口语
- 内容创作者小王需要为视频配音，希望AI能模仿特定角色声音

## 功能需求与优先级

### 核心功能（高优先级）
1. **角色搜索与浏览** - 支持按类别、标签搜索角色
2. **智能对话系统** - 基于角色性格的AI对话
3. **语音交互** - 语音输入输出，实时语音聊天
4. **角色管理** - 创建、编辑、删除自定义角色

### 增强功能（中优先级）
5. **情感分析** - 分析用户情绪，调整回复策略
6. **知识问答** - 角色专业知识问答能力
7. **语音克隆** - 基于参考音频生成角色声音
8. **多语言支持** - 支持中英日韩等多语言对话

### 高级功能（低优先级）
9. **角色技能系统** - 特定领域的专业技能
10. **对话记忆** - 长期对话记忆和上下文理解
11. **角色关系** - 多角色互动场景
12. **内容生成** - 生成角色相关的故事、诗歌等

## LLM模型选择

### 选择：七牛云 x-ai/grok-4-fast 模型

### 选择理由
1. **中文优化**：专门针对中文场景优化，角色扮演效果更好
2. **成本效益**：相比GPT-4成本更低，适合大规模部署
3. **响应速度**：fast版本响应快，提升用户体验
4. **本地化**：七牛云国内服务，访问稳定
5. **项目集成**：当前项目已集成七牛云服务，技术栈统一

## 技术架构

### 系统架构图

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端 Web      │    │   前端 Mobile   │    │   管理后台      │
│   (Next.js)     │    │  (React Native) │    │   (Next.js)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   API Gateway   │
                    │   (FastAPI)     │
                    └─────────────────┘
                                 │
         ┌───────────────────────┼───────────────────────┐
         │                       │                       │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   AI 服务层     │    │   语音服务层    │    │   存储服务层    │
│   (七牛云LLM)   │    │  (ASR/TTS)     │    │  (七牛云/本地)  │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         └───────────────────────┼───────────────────────┘
                                 │
                    ┌─────────────────┐
                    │   数据库层      │
                    │  (MySQL/Redis)  │
                    └─────────────────┘
```

### 核心组件

#### 前端架构
- **Web端**：Next.js 14 + TypeScript + Tailwind CSS
- **移动端**：React Native + TypeScript
- **状态管理**：React Context + Custom Hooks
- **UI组件**：Radix UI + Lucide React
- **动画**：Framer Motion

#### 后端架构
- **API服务**：FastAPI + Python 3.9+
- **数据库**：MySQL 8.0 + Redis 6.0
- **AI服务**：七牛云 x-ai/grok-4-fast
- **语音服务**：GPT-SoVITS + 七牛云ASR
- **存储服务**：七牛云对象存储

#### 语音处理流程
```
用户语音输入 → 前端录音 → 七牛云ASR → 文本识别 → 七牛云LLM → GPT-SoVITS TTS生成 → 音频播放
```

### 数据流图

#### 1. 角色对话流程
```
用户输入 → 前端验证 → API Gateway → AI服务 → 七牛云LLM → 角色回复生成 → TTS服务 → 语音合成 → 前端播放
```

#### 2. 语音交互流程
```
语音录制 → ASR识别 → 文本处理 → LLM对话 → TTS合成 → 音频播放
```

## 技术栈详情

### 前端技术栈
- **框架**：Next.js 14 (App Router)
- **语言**：TypeScript 5.2+
- **样式**：Tailwind CSS 3.3+
- **组件库**：Radix UI + 自定义组件
- **状态管理**：React Context + Custom Hooks
- **动画**：Framer Motion 10.16+
- **图标**：Lucide React 0.292+
- **语音**：Web Speech API + React Speech Kit

### 后端技术栈
- **框架**：FastAPI 0.104+
- **语言**：Python 3.9+
- **数据库**：MySQL 8.0 + SQLAlchemy 2.0+
- **缓存**：Redis 6.0
- **AI服务**：七牛云 x-ai/grok-4-fast
- **语音处理**：GPT-SoVITS + 七牛云ASR
- **存储**：七牛云对象存储
- 
### 移动端技术栈
- **框架**：React Native 0.72+
- **语言**：TypeScript
- **导航**：React Navigation 6
- **状态管理**：React Context
- **语音功能**：React Native Voice
- **音频处理**：React Native Audio Recorder Player
- **网络请求**：Fetch API
- **数据存储**：AsyncStorage

## 部署架构

### 开发环境
```
本地开发 → 本地数据库 → 七牛云服务
```

## 性能优化

### 前端优化
- **代码分割**：Next.js自动代码分割
- **图片优化**：Next.js Image组件
- **缓存策略**：SWR数据缓存
- **PWA支持**：离线访问能力

### 后端优化
- **异步处理**：Celery任务队列
- **数据库优化**：索引优化 + 查询优化
- **缓存策略**：Redis缓存热点数据
- **API限流**：防止API滥用

### 语音优化
- **音频压缩**：WebM转WAV优化
- **流式处理**：实时语音处理
- **降级策略**：多引擎ASR降级
- **CDN加速**：音频文件CDN分发

## 安全措施

### 数据安全
- **HTTPS加密**：全站HTTPS访问
- **数据加密**：敏感数据AES加密
- **访问控制**：JWT Token认证
- **API限流**：防止恶意请求

### 隐私保护
- **数据最小化**：只收集必要数据
- **用户控制**：用户可删除数据
- **匿名化**：敏感信息匿名化处理
- **合规性**：符合数据保护法规

## 监控与运维

### 监控指标
- **性能监控**：响应时间、吞吐量
- **错误监控**：错误率、异常追踪
- **业务监控**：用户活跃度、功能使用率
- **资源监控**：CPU、内存、磁盘使用率

### 日志管理
- **应用日志**：结构化日志记录
- **错误日志**：异常堆栈追踪
- **访问日志**：API访问记录
- **审计日志**：用户操作记录

## 开发指南

### 环境要求
- Node.js 18.0+
- Python 3.9+
- MySQL 8.0+
- Redis 6.0+

### 快速开始
```bash
# 克隆项目
git clone <repository-url>
cd QiNiuMagicRole

# 安装依赖
cd frontend_web && pnpm install
cd ../server && pip install -r requirements.txt

# 配置环境变量
cp server/env.example server/.env

# 启动服务
# 后端
cd server && python run.py

# 前端
cd frontend_web && pnpm dev
```

### 项目结构
```
QiNiuMagicRole/
├── frontend_web/          # Web前端
├── frontend_mobile/        # 移动端
├── server/                 # 后端服务
└── llm_server/             # 文档
```